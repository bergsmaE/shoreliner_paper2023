%  LaTeX support: latex@mdpi.com 
%  For support, please attach all files needed for compiling as well as the log file, and specify your operating system, LaTeX version, and LaTeX editor.

%=================================================================
\documentclass[remotesensing,article,submit,pdftex,moreauthors]{Definitions/mdpi} 

%=================================================================
% MDPI internal commands - do not modify
\firstpage{1} 
\makeatletter 
\setcounter{page}{\@firstpage} 
\makeatother
\pubvolume{1}
\issuenum{1}
\articlenumber{0}
\pubyear{2023}
\copyrightyear{2023}
%\externaleditor{Academic Editor: Firstname Lastname}
\datereceived{ } 
\daterevised{ } % Comment out if no revised date
\dateaccepted{ } 
\datepublished{ } 
%\datecorrected{} % For corrected papers: "Corrected: XXX" date in the original paper.
%\dateretracted{} % For corrected papers: "Retracted: XXX" date in the original paper.
\hreflink{https://doi.org/} % If needed use \linebreak
%\doinum{}
%\pdfoutput=1 % Uncommented for upload to arXiv.org

\newcommand{\myfigure}[4]{
    \begin{figure*}[ht!]
        \centering
        \includegraphics[width=#4\textwidth]{#1}	 
        \caption{\itshape#2}
        \label{#3}
    \end{figure*} 
}


%=================================================================
% Full title of the paper (Capitalized)
\Title{Sub-pixel instantaneous waterline extraction method for multi-spectral satellite optical imagery}

% MDPI internal command: Title for citation in the left column
\TitleCitation{Sub-pixel instantaneous waterline extraction method for multi-spectral satellite optical imagery}

% Author Orchid ID: enter ID or remove command
\newcommand{\orcidauthorA}{0000-0002-7638-1108} % Add \orcidA{} behind the author's name
%\newcommand{\orcidauthorB}{0000-0002-7638-1108} % Add \orcidB{} behind the author's name

% Authors, for the paper (add full first names)
\Author{Erwin W.J. Bergsma $^{1}$*\orcidA{}, Adrien Klotz $^{1,2}$, St\'{e}phanie Artigues$^{1}$, Marcan Graffin$^{1,2}$, Anna Prenowitz $^{1}$, Rafael Almar$^{2}$}

%\longauthorlist{yes}

% MDPI internal command: Authors, for metadata in PDF
\AuthorNames{Erwin W.J. Bergsma, Adrien Klotz, St\'{e}phanie Artigues, Marcan Graffin, Anna Prenowitz and Rafael Almar}

% MDPI internal command: Authors, for citation in the left column
\AuthorCitation{Bergsma, E.W.J.; Klotz, A.; Artigues, S.; Graffin, M, Prenowitz, A., Almar, R}
% If this is a Chicago style journal: Lastname, Firstname, Firstname Lastname, and Firstname Lastname.

% Affiliations / Addresses (Add [1] after \address if there is only one affiliation.)
\address{%
$^{1}$ \quad CNES (French Space Agency), Earth Observation Lab, 18 Av. Edouard Belin, 31400, Toulouse, France; \\
$^{2}$ \quad IRD-LEGOS (Research Institute Pour Le Developpement - Laboratoire d’Etudes en Geophysique et Oceanographie Spatiales), UMR5566, 14 Av. Edouard Belin, 31400, Toulouse, France;}

% Contact information of the corresponding author
\corres{Correspondence: erwin.bergsma@cnes.fr}

% Abstract (Do not insert blank lines, i.e. \\) 
\abstract{Coastal zones around the world are sporadically measured and often at local beaches while many processes surpass these zones and time-scales. The beaches that are well-known and regularly measured, can be found at higher latitudes in predominantly storm/seasonal driven environments. One could state that our knowledge of the coastal zone might be biases. Waterline detection from spaceborne sensors is an emerging alternative that enables to cover large scale and relatively high-frequency monitoring. Here, we explore a novel, optimised method to detect the instantaneous water line in coastal areas (SCoWI) developed using the Sentinel-2 satellite optical data. The method is developed at sandy beaches around France (particularly the different environment of the Atlantic ocean and Mediteranean sea), applied to challenging cliffed and black-sand beaches before it was quantitatively validated at Duck, NC in the US. Excellent sub-pixel (1/4 pixel) performance was found, and significantly computationally efficient on the CNES' High Performance Cluster (HPC) to be launched at very large scales, as shown with a testcase at Saint Louis in Senegal. In addition to the development on the Sentinel-2 satellite optical imagery, the transferability to other satellite sensors among which Landsat has been explored. When assessed at Duck on the same day; Sentinel-2 and Landsat imagery several minutes apart provides similar results for the detected waterline, within the method precision. The next step is to integrate a variety of satellite sensors on the HPC, and continue global validation using the 40-years data acquisitions of Landsat combined with the greater resolution Sentinel-2 data.}

% Keywords
\keyword{keyword 1; keyword 2; keyword 3 (List three to ten pertinent keywords specific to the article; yet reasonably common within the subject discipline.)} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
Sandy coasts around the world are in constant search for the natural equilibrium with the environmental forcing it is exposed to. This natural morphodynamic behaviour is often controlled by human interventions to serve the goal of dictating our coastal environment, so it becomes predictable and manageable. It is this anthropogenic pressure that lies at the root of concepts such as coastal risks/hazards and solutions such as hard coastal structures. Without this anthropogenic pressure, there is just the natural movement of the shoreline (as being the instantaneous waterline corrected for hydrodynamic influences) at varying spatiotemporal scales. Erosion and accretion often have a direct effect on populations that live from the sea and reside in its vicinity. As a general concept, the shoreline position is a solid proxy (not a holistic view) for beach health and degree of protection; the wider your beach, the greater your buffer between land and sea, the greater your protection against environmental conditions and lower the (flooding) risk. Hence, measuring the instantaneous waterline can enable us to observe natural morphology \citep{Vitousek:17b}, predict future shoreline positions \citep{vitousek:23} and deduct coastal risk indicators from them.

It is important to note that different shoreline-related questions require different and adequate spatial-temporal scales of data to be answered. Where the shoreline can be measured by GPS, one cannot expect to have a measurement at high frequencies (for example every hour). Shore-based video camera systems can deliver a shoreline position (averaged instantaneous waterline in time -- or exposure) almost on an instant basis every 10-min they only cover local scales. Satellites can provide a sweet mean between the two, where freely available global optical satellite data is now acquired at least every 5 days, and by combining a suit of satellites in orbits this can be brought down to near-daily. So where it traditionally required quite an effort and financial investment to occasionally measure coastal indicators like the shoreline, we now benefit from data and infrastructure to analyse a local beach using a simple laptop with an internet connection and scale up to regional and even global studies if deployed on High-Performance cluster infrastructures. 

As the attentive reader might have notices, we alternated between shoreline and instantaneous waterline. The shoreline can be defined in multiple ways. In this work we focus on detecting the instantaneous waterline at the moment of sensing the satellite image. While the shoreline can be estimated using non-optical data, in this work we focus on optical satellites only, and we presume that the whole satellite image is acquired at the same instant (which is not the case and can be 20-40\% of a typical swash period \citep{binet2022accurate}). Optical satellite imagery is typically used to create indices like for example widely used NDWI (Normalised Difference Water Index) or AWEI$_{sh}$ that are thresholded to find the land/sea limit. Conceptually this is what implementations like CoastSat\citep{VOS2019_google}, CASSIE\citep{ALMEIDA2021_Cassie}, PyIntertidalDEM\citep{Khan2019} and ECFAS employ to find the instantaneous waterline with differences their workflow and accessibility. Unfortunately, none of these methods have proven to be at the same time robust to many coastal environments, fully automated while being fast enough to enable large scale and temporal studies and require manual interventions. Here, we aim to fully automatically detect the shoreline as accurate and computationally efficient as possible through the creation of a radio-metrically optimized indicator and integration in the CNES-HPC. At first, we start with Sentinel-2 data as all Sentinel-2 satellite data is directly available on the CNES-HPC to the computational core, which allows for large spatio-temporal scale applications within a reasonable time-frame.

In sections below we set out the optimisation of a radiometric index to optimally separate land and sea using past knowledge on a variety of approaches. We set out the processing pipeline to extract the water index and find the optimum land sea limit. The method is mainly developed on the Atlantic coast of France and is then validated without modification in other parts of the world like Saint Louis in Senegal and around the FRF at Duck in the USA. In the discussion section limits, large scale applications and the transferability to other satellite optical sensors, notably the Landsat series is discussed followed by the conclusions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Methods}
\subsection{Water indices, a separation between land and sea}
As a general matter, satellite derived indices using a set of colour bands are often used to identify, measure, follow and analyse natural processes. Like a vegetation index (using the red and Near Infra Red (NIR) bands) can be used to trace the health of the vegetation, yield of agricultural crops and even the likelihood to be a hotspot for mosquitos. Water indices are more used to distinguish water from land, to detect lakes, rivers, floods and similarly in the coastal zone to detect the instantaneous water line. Probably one of the most used and well know index to separate land from water is the Normalised Difference Water Index (NDWI) using the NIR and green or NIR and SWIR (Short Wave Infrared band). The NDWI or its close relative MNDWI are ratio based indices. Normalisation has its advantages, it is less affected by fluctuations in radiometric response, but it also has a disadvantage, for example pan-sharpening is less effective as the ratio of the colour bands remains identical, even while pan sharpened. For example in \textit{Coastsat} --(checked on v2.0) they opt to bi-linearly interpolate the colour bands before pan-sharpening, essential to smooth the result and increase the resolution. Another type of index is a RGB composition, a combination of bands in the false-RGB colour space, widely used to detect inland water bodies \citep{PEKEL2014704}. Using the RGB composite of bands results in a single image that can be translated to a grayscale image using colorimetric analysis to separate land and sea. Such a method is deployed in \citet{Khan2019} to extract waterlines at different stages of the tide into the vast coastal region of the Bengal delta. 

Besides these two types of approaches we find substractive indices; like the one of the most used AWEI (Automated Water Extraction Index) \citep{FEYISA201423}. These indices are not ratios or normalised and can therefore be used in pan-sharpened fashion. Substractive indices typically rely greater radiometric resolution, or in other words more spectral bands, that are often not available on very high resolution satellites like Pleiades or Worldview. While developed for Landsat, the AWEI is likewise a reliable index applied to Sentinel-2. This can be contributed to an effective optimisation (more than a MNDWI for example) to separate land and water around a 0 value by enhancing the spectral contrast. The AWEI index comes in two fashions: AWEI for images with shadows (AWEI$_{sh}$) and and without shadows (AWEI$_{nsh}$) \citep{FEYISA201423}.

\begin{equation}
    \textrm{AWEI$_{sh}$} = \textrm{B} + 2.5\textrm{ G} - 1.5 (\textrm{NIR} + \textrm{ SWIR$_{1}$}) - 0.25 \textrm{ SWIR$_{2}$}
\end{equation}

\begin{equation}
    \textrm{AWEI$_{nsh}$} = 4 (\textrm{G} - \textrm{ SWIR$_{1}$}) - (0.25 \textrm{ NIR} + 2.75 \textrm{ SWIR$_{2}$})
\end{equation}

in which $B$ represents the blue band (490 $nm$), $G$ is green (560 $nm$), NIR is the near-infrared band (842 $nm$), and SWIR$_{1}$ and SWIR$_{2}$ are respectively the Short wave Infrared bands with wave lengths of 1610 $nm$ and 2190 $nm$. In terms of waterline extraction the AWEI seems more accurate in comparison to normalised indices for a variety of environments like sandy beaches, artificial coastlines, rocky coastlines, wetlands and mudflats. This can be explained by the fact that subtractive indices like AWEI have a linear response with respect to the fractional composition of land and water within a pixel whereas the response of a ratio based index like NDWI and MNDWI is non-linear \citep{Bishop_sub_pixel}. However, while the AWEI outperforms normalised indices, it is not radiometrically optimised to detect the waterline in humid swash areas. Often the AWEI$_{nsh}$ classifies rocks and dark land bodies as water and while the AWEI$_{sh}$ performs better compared to the AWEI$_{nsh}$, the AWEI$_{sh}$ tends to classify wet sand areas as water. It is exactly in this area, around the waterline in the swash zone, while tides are falling and/or at very dissipative flat beaches, where wet sand areas are abundant in the intertidal zone. Taking the AWEI$_{sh}$ as a base we will explore in the following sections a radiometric optimisation, overcoming the shoreward estimation tendency of the AWEI$_{sh}$ to robustly and fully automatically detect the instantaneous waterline.

\subsubsection{Radiometric response in the intertidal zone and optimisation}
To understand the radiometric responses per spectral band in the coastal zone and the effects on the substractive index, we explore the spectral response over a cross shore line as represented by the fat red line in the right plot in Figure \ref{band_compare}. Using the spectral bands of the AWEI$_{sh}$ the individual responses over the cross shore line are plotted on the left starting from offshore on the left to land on the right. Over the cross section 5 zones are designated in shoreward order; water, white-water where waves break, wet sand, dry sand and land (in the case of Figure \ref{band_compare} it is vegetation but this is not a prerequisite). For this analysis we used the Sentinel-2 MSI Level1C product that delivers the reflected radiance multiplied by a factor 10000. Wherein Blue, Green, Near Indra-Red (NIR), Short Wave Infra-red 1 and 2 (SWIR$_{1}$, SWIR$_{2}$) respectively correspond to the bands B02, B03, B08, B11 and B12.

\myfigure{img/band_compare_CAPBRETON.png}{Example of the spectral response along the 5 cross shore zones. The instantaneous waterline (land/water limit marker) is our target here.}{band_compare}{1}

From Figure \ref{band_compare} it is evident that each zone has its characteristic spectral signature. Some clear patterns can be found, for example, on water the spectral response of in the NIR and SWIR bands are near zero as water absorbs most of the photons in these ranges, while as we hit land the response in infra-ref channels increases. For the visible bands, the blue and green there is a greater, but medium ($\sim 1200$), radiance. As waves break closer to shore and generate foam due to breaking, the spectral response is high in blue, green and NIR bands ($\sim 4500$) but stays low for SWIR bands ($\le 1000$). Particularly the NIR band shows a sudden increase in reflected radiance. It is worth mentioning that for the water zones (water + white water) the blue and green bands are always higher than all infra-red bands. 

Now as we hit land, in this case wet sand, the latter observation is no longer valid: there the  infra-red bands show a greater response in comparison to the green and blue bands. The SWIR bands characteristically increase of their response progressively around this zone. The cross shore location at which the NIR response exceeds the response of the blue and green bands indicates the boundary that corresponds to the instantaneous waterline. Further landward, the sand zone, exhibits a medium response for the blue and green bands ($\sim 2000$) but also a high response of the 3 Infra-Red bands. And lastly, the land zone shows a medium response for all bands ($\sim 1000$). On land, NIR has generally a greater response than any other bands but we remark that NIR also presents a greater variability (noisier) compare to the other bands.

In conclusion, Sentinel-2 Level1C acquisitions exhibit a clear delimitation corresponding to the instantaneous waterline; namely, the transition between a greater response of the blue and green bands on the water side and a greater response of the NIR band on the land side.

\subsubsection{SCoWI: Optimized water index for coastal zones}\label{SCOWI_sec}
Given our objective to distinguish water and land as best as possible, the index used should aim to have a maximum but balanced difference in index values for land and sea and a minimum (around 0) for the interface. Here we perform a radiometric/index optimisation to achieve exactly that. Taking the AWEI$_{sh}$ as our starting point, the mean AWEI$_{sh}$ per zone can be calculated. To ensure robustness, four different arbitrarily selected coastal sites are combined in this analysis. The mean AWEI$_{sh}$ values for all sites per zone are depicted by the blue vertical bars in Figure \ref{SCoWI_estimation}. 

\myfigure{img/SCoWI_optimisation.png}{Comparison of the estimated values of the SCoWI (orange bars) against the AWEI$_{sh}$ (blue bars) over the 5 areas of the intertidal zone. The SCoWI has lower estimated values than AWEI$_{sh}$ on the white-water and wet sand area, optimising the extraction of the waterline.}{SCoWI_estimation}{0.5}

While theoretically aimed to be around 0, the wet sand value is remarkably high, around 1800, and thus considered water. Following this, in the coastal zone under the presence of wet sands, the the AWEI$_{sh}$ is likely to estimate the instantaneous waterline landward of the actual waterline. Moreover, white-water is evidently overvalued given the excessively high value in Figure \ref{SCoWI_estimation}. This overvaluation could form an imbalanced third distribution peak which is not ideal for the application of an automatic thresholding method assuming a bimodal distribution.

Starting from the AWEI$_{sh}$, one can optimise the coefficients iteratively to obtain a well balanced distribution (reducing the overvaluation of white water) in which wet sand is closer to land values and around zero. Keeping the same bands as the AWEI$_{sh}$, an optimised expression if found that reaches our aim, emphasising the waterline interface, and we call it the "\textit{Subtractive Coastal Water Index}" or SCoWI : 

\begin{equation}
    \textrm{SCoWI} = \textrm{B} + 2(\textrm{G} - \textrm{NIR}) - 0.75 \textrm{ SWIR$_{1}$} - 0.5 \textrm{ SWIR$_{2}$}
    \label{eq:scowi}
\end{equation}

Using equation \ref{eq:scowi}, the same exercise as above is repeated and the results are represented by the orange vertical bars in Figure \ref{SCoWI_estimation}. In general lower absolute values are found for each zone ($\approx -600$), but the distribution is notably more balanced and well zero-ed about the water-land interface. In comparison to the AWEI$_{sh}$, the SCoWI puts more weight on the NIR response and less on the green band. This to emphasise the transition where the NIR response becomes greater than visible bands between the white-water and the wet-wand : the instantaneous waterline. Additionally, the SWIR bands permit to adjust the SCoWI response and fine-tune the balance of the distribution.
        
\subsection{Waterline extraction process}\label{extract_process}
An index is just a part of the complete process to deploy satellite imagery to extract instantaneous waterlines. This section presents the process involved to extract the instantaneous waterline on Level1C Sentinel-2 satellite optical imagery. Following the method proposed by \citep{Bishop_sub_pixel}, a refined and robust process using the SCoWI presented before and a new histogram thresholding procedure extracting sub pixel waterline is described.

\subsubsection{Sentinel-2 imagery and pre-processing}
As mentioned above, for this work we use Level1C Sentinel-2 satellite optical imagery as all Level1C products are directly available on the CNES' HPC and does not depend on the choice of atmospheric correction routine applied. The Sentinel-2 MultiSpectral Instrument (MSI) measures the Earth reflected solar photons, luminance which is converted to reflected radiance in the Level1C product. The instrument is orientated in nadir orientation and has a radiometric resolution of 13 spectral bands with varying resolutions between 10, 20 and 60 m. The Sentinel-2 mission provides a systematic multispectral coverage of all land areas between 56 degrees South latitude (Cape Horn in South America) and 84 degrees North latitude (north of Greenland) including major islands (greater than 100 km$^2$ size), European islands and all the other small islands located at less than 20 km from the coastline. Sentinel-2 has a revisit time going from 5 days at the equator up to 1 day on the highest latitudes \citep{ESAreq}, and at the coasts this results in a variety of revisit times depending on the location \citep{BERGSMA2020}.

Systematically acquired and processed Sentinel-2 Level1C products are radiometrically and geometrically corrected, including ortho-rectification and spatial registration on a global reference system. Each pixel represents a radiometric measurements at the Top Of Atmosphere (TOA) in reflectance. New acquisitions are typically made available within 3 to 24 hours, enabling near-real time to non-time critical analysis. The pre-procesing of the Level1C Sentinel-2 data is minimal before we can use it for a SCoWI estimation. The resolution of all bands are equalised by downsampling the 20 meter SWIR bands to 10 meter resolution using a cubic interpolation. In addition, a cloud mask is computed combining the cirrus and opaque cloud masks delivered with the Sentinel-2 Level1C products.

\subsubsection{Waterline detection and extraction}
Once a Sentinel-2 product is pre-processed the SCoWI is calculated using equation \ref{eq:scowi} resulting in a grey scale image with unbounded values. To this grey-scale image the computed cloud and nodata masks are applied to remove erroneous pixels to our aim and process. In theory, pixel values greater than 0 represent water pixels and the image should present a bimodal distribution histogram. However, for full automatization robustness, the instantaneous waterline is often detected using adaptive thresholding techniques like the Otsu method \citep{Bishop_sub_pixel, VOS2019_sub}. Otsu's method can be applied based on the hypothesis that the SCoWI grey-scale image has a bimodal distributed histogram as Otsu's threshold is determined by minimising intra-class variance $\sigma_w^2$ of a list of values presenting a bimodal distribution \citep{OTSU1979}.

For each grey-scale image at a given date we pose $T_0$ as being the minimum obtained SCoWI value and $T_N$ being its maximum SCoWI values. Then the Otsu's threshold is given by :

\begin{equation}
    t_{otsu} = \operatorname*{argmin}_t \sigma_w^2(t) \text{, where }T_0 \le t \le T_N
\end{equation}

Unfortunately, while mathematically correct, given the application here, it is likely for the Otsu threshold to lack accuracy in cutting the 2 distributions on the histogram considering that the histogram can be affected by the size of scene around the coastline and percentage/distribution of land/sea pixels. Or for example during falling to low-tide conditions, that often poses challenged for SDS methods due to the abundance of wet sand patches that impact the instantaneous waterline detection \citep{CASTELLE2021107707}. When using the AWEI$_{sh}$ these wet sandy patches are detected as water, leading to a landward observation of the instantaneous waterline and an alternation of the index distribution. Similar issues are reported using MNDWI in \citet{VOS2019_sub}. 

\myfigure{img/AWEIsh_vs_SCOWI_crop.png}{a) AWEI$_{sh}$ histogram of this Sentinel-2 acquisition. The dashed blue line is the Otsu threshold value computed for this histogram. b) SCoWI histogram of this Sentinel-2 acquisition in which the dashed green line indicates the Otsu threshold value while the dashed red line shows the position of the local histogram minimum. c) Sentinel-2 acquisition at Capbreton, French Atlantic coast during low tide. Instantaneous waterlines are extracted through the 3 methods: cyan is AWEI$_{sh}$, green represents the SCoWI with Otsu and red shows the SCoWI with local minimum approach. Waterline extracted by the SCoWI combined to the local minimum histogram thresholding method (red line) is the closest to the actual waterline on the acquisition. }{SCOWI_vs_AWEI_hist}{0.8}

Physically, the threshold should be between the 2 distributions where both modes combined are minimal. In addition to the original Otsu method, the minimum histogram condition called the local minimum histogram thresholding is introduced to improve the threshold to be closed to the effective instantaneous waterline. After computing the Otsu threshold on the SCoWI histogram, local maximums are computed and selected to define an interval $[t_1 ; t_2]$ on each side of the Otsu threshold so that $t_1 \le t_{otsu} \le t_2$ where $t_1$ and $t_2 \in [T_0;T_N]$ and are local maximums of the histogram. Finally, the local minimum threshold $t_{min}$ is defined as the minimum argument of the histogram in the interval $[t_1 ; t_2]$. By doing so, we ensure that the computed threshold to delimit the 2 distributions as close as possible to the point, in effect, minimises the intra-class variance of the histogram. Three approaches; AWEI$_{sh}$, SCoWI with Otsu and SCoWI with optimised minimum search are presented in Figure \ref{SCOWI_vs_AWEI_hist} to practically illustrate the respective contributions.

Now a threshold value can be found, exact coordinates of the instantaneous waterline deducted. If done directly on the single grey-scale image, this results in a stepped, pixellic, waterline linked to the resolution of the satellite optical imagery (in this case 10 meters). To overcome this issue, a sub-resolution marching square mapping algorithm using the local minimum threshold applied to the SCoWI image is deployed, like presented in \citet{VOS2019_sub}. A key hypothesis is that pixels at 10 meters resolution along the waterline present a mix of water and land, and that water index values for these pixels directly reflects the relative proportion of water and land within those pixels. If so, it is possible to take the relative water index values of four neighbouring pixels into account to find a more precisely geolocation the threshold line compared to simply drawing a line directly at the centre or edges of thresholded pixels. The marching square algorithm linearly interpolates SCoWI values of neighbouring pixels to map out the precise location of the waterline according to the specified threshold value \citep{CIPOLLETTI201287}.

\section{Validation}
So far all the discussed manipulations above have been developed at sites along the European mainland and its overseas territories. There is however only few sites worldwide, practically non-other than the ERDC's Field Research Facility (FRF) at Duck, NC, USA, that has a temporal direct-measurement density (not video derived shoreline proxies) to appropriately validate the performance of the SCoWI procedure. Hydrodynamics are consistently measured day and night and since 1981, monthly to fortnightly in-situ high-quality topo-bathymetric surveys have been conducted at the FRF \citep{FORTE2017}. In addition, the National Oceanic and Atmospheric Administration (NOAA) has installed since 1995 a water level sensor measuring the level of the sea at Duck every 6 minutes \citep{park2014water}. From the measured bathymetry and instant nearshore water level (within 6 minutes -- effectively 3 minutes) on a given day and time, we deduct a reference instantaneous waterline. This reference waterline is projected in the same coordinate system as the Sentinel-2 before it is then compared to the instantaneous SCoWI derived waterline measured using Sentinel-2 acquisition of the same day. Notably, we like to stress that the FRF has not been a site among the representative beaches used to optimise SCoWI.

\myfigure{img/Results.png}{Comparison of waterline extracted using the new SCoWI-based extraction method (shoreliner) proposed in this paper (green line) with the in-situ measured waterline (red line). The right-hand side histograms display the positional error between the extracted and measured waterline. The smallest the cross-shore RMS error achieved a value of 2.6 meters corresponding to 1/4 of the Sentinel-2 pixel.}{validation}{1}

For the validation we focus ourselves to a 3-year period, from August 2019 until August 2022, over which 106 waterlines could be estimated, considering cloud coverage etc., (which in line with \citep{BERGSMA2020}). Among these 106 Sentinel-2 acquisitions, only 6 occurred on the same day as an in-situ topo-bathymetric survey at Duck. Figure \ref{validation} shows three of those results over the 3 years. At best over these 6 dates, we find that the SCoWI approach is capable to estimate the instantaneous waterline with an RMS error of 2.6 meters, bias of 0.8 m and standard deviation of 2.5 m. This corresponds to an RMS of 1/4 pixel. From the 6 dates that have a satellite acquisition and an in-situ survey, 5 dates show a sub-pixel RMS error, below 10 meters. This sub-pixel performance of the extraction processing demonstrates the ability of this proposed SDS extraction method to extract reliable instantaneous, and stable waterlines.

When compared to a state-of-the-art SDS extraction method, CoastSat \citep{VOS2019_sub}, SCoWI produces comparable results or outperforms Coastsat. Taking the Sentinel-2 image of 17 April 2020, SCoWI has an RMS error of 2.6 m versus respectively 16.7 m for Coastsat, a bias of 0.8 m versus 16.3 m and a comparable standard deviation of 2.5 versus 3.5 m. If we compare computational time, using identical computational nodes, available memory and identical Sentinel-2 scenes covering 348 km$^2$, SCoWI is computed in 2.237 seconds while Coastsat took 27.873 seconds. It is evident that the SCoWI is 12.5 times faster as it is a direct calculation without pixel classification which is computationally costly.

% Shoreliner    2.237 s   x 1
% pyIntertid    3.245 s   x 1.45  x 1
% CoastSat      27.873 s  x 12.5  x 8.6
% Area of 348 km$^2$

\section{Results and discussion}
Individual dates show good performance, and similar to \citet{VOS2019_google}, each date can be coupled to a tidal elevation, e.g. CNES' AVISO+ FES model, to reconstruct an inter-tidal topography, evaluate beach slopes and correct the waterline position for tidal influences and run-up and deduct a shoreline. Here, these corrections are considered essential and evidently the same corrections apply directly to our instantaneous waterline. 

\subsection{Large scale applications}
Recent trends in waterline detection show the significance of local applications to validate and better understand the performance of the waterline detection whereafter these same methods are extended to larger spatiotemporal scales \citep{VOS2019_sub, almar2021global, Vos2023}. Although the waterline is a first order approximation of morphological change, fluctuations at the coast and climate impacts, it does deliver very valuable insight in the impact of example climate modes on the coastal zone. Also, in areas that are traditionally data poor, like most of Africa \citep{almar2022coastal}.  

Let us consider St. Louis in Senegal, a storm-free environment exposed to domination of bidirectional very energetic swells that originate from far off to the Northern or Southern Atlantic Ocean. Most of the time the Northern component dominates, resulting in a very strong alongshore transport and migrating sand-spit (called \textit{Langue de Barbarie}) towards the South \citep{bergsma2020sand, taveneau2021observing}. In 2003, an artificial breach of the sand-spit was forced to relieve the city of St. Louis from extreme water levels on the land-side. Since 2018, St. Louis is monitored regularly to understand the morphodynamics to better adapt to future changes. Interestingly, the beach in front of the city of St. Louis was at most erosive state at this time, the beach virtually disappeared, leaving the fishermen houses and supporting facilities exposed to the elements. After 2019, a strong accretion has been observed, a perfect case to test our waterline detection. 

For this case we use all available Sentinel-2 imagery up until 2022. The CNES High Performance Cluster (HPC) functions as an official mirror of ESA's servers through the PEPS (\textit{Plateforme d'Exploitation des Produits Sentinel}) programme. The cluster basically combines data availability and computational power. The SCoWI, and other supplementary indices, are integrated into a processing pipeline similar for the Sentinel-2 bathymetry estimation as in \citet{daly2022new}. After defining a region of interest, date range and auxiliary bookkeeping parameters the cluster automatically finds all implicated Sentinel-2 imagery, pre-/process/post-process the images, SCoWI and waterline detection before it couples the waterlines to a tidal elevation using FES. Once the images are ready to be used, it is a matter of minutes to analyse the 8 years of data. Figure \ref{senegal} shows the typical result around St. Louis, Senegal.

\myfigure{img/senegal_stLouis_thinLines.png}{2015-2022 application at St. Louis, Senegal}{senegal}{1}
%\myfigure{img/senegal_stLouis_color_GEOSCIENCEAUSSIES_thinLines.png}{2015-2022 application at St. Louis, Senegal}{senegal}{1}

The colouring of the lines in Figure \ref{senegal} relates to a certain date; the colour bar just shows colour increment per year. The overall waterline estimation covers a 40 km stretch along the coast from Mauritania to village L\'{e}ona. The left-hand plot zooms in on a part of the St. Louis village situated on the sand-spit. This area is particular exposed to waves, and energy in the infra-gravity domain, that inundate the inhabited area. Following the colour code of the lines, one can see the beach eroding between 2015 and 2019, while after 2019 this part of the beach showed significant accretion. The exact cause is currently under investigation as part of the World bank's WACA programme, and is not part of this study. The two plots on the right of Figure \ref{senegal}, show the tip of the sand-spit South of the city of St. Louis. Between August 2015 and end-December 2022 the sand-spit migrated 3700 m southward, an average 530 m per year. The average time-interval between waterline detections was 5 to 10 days depending on the season mostly impacted by clouds and dense Sahara dust.
 
\subsection{Transferability to other satellite sensors}
To upscale to large spatiotemporal scales, conserving sufficient local resolution, Sentinel-2 alone is not enough. While the Sentinel-2 dataset is growing, and the Copernicus programme is maintained with Sentinel-2C and D, even extended with Sentinel-2NG (Next Generation), the time-series is not long enough to see the effects of long temporal scale coastal evolution. The SCoWI depends on the spectral bands in the visible domain and the SWIR domain, as long as these spectral bands are maintained in future satellite series, the waterline detection should work. USGS' Landsat series does have a long, over 40-years, record of Earth Observation satellite data. While the ground-sampling resolution and revisit time interval are slightly worse in comparison to Sentinel-2, it does provide an opportunity to look further back in time. 

The Landsat spectral bands are in a similar range as Sentinel-2 but not purely identical. There are considerable efforts to harmonize the Sentinel and Landsat acquisitions but this is for example one of the reasons that \citet{VOS2019_google} needs to retrain the Coastsat module for each satellite and sensor type. Let us try to just blindly apply the SCoWI index, optimised for Sentinel-2 to some Landsat satellite optical imagery, acquired around the FRF at Duck, USA. Like most Earth Observation optical satellites, Sentinel-2 and Landsat are both sun-synchronised satellites; generally passing over between 10h30 and 11h30 local time. There is only a few dates at which both Sentinel-2 and LandSat pass over at the same day, sometimes several minutes apart. The images in Figure \ref{landsat} represent an illustration of such a date with which we can understand the method transferability.

\myfigure{img/duck_comparison.png}{SCoWI applied to Sentinel-2 and LandSat satellite optical imagery. The left-hand image shows the SCoWI applied to a Sentinel-2 image and the middle image to Landsat-8 image. The greyscale limits are set between 2\% to 98\% of all pixel values for both images. The coloured lines represent the detected instantaneous water line, which are then both superimposed onto a Sentinel-2 image on the right-hand side.}{landsat}{1}

The left-hand image in Figure \ref{landsat} illustrates the effective separation of land and sea using the SCoWI formulation. Water pixels are rather light while land-pixels are dark. Likewise, when applied to the Landsat imagery. Notably, given the different spatial resolution one might expect a large difference between the derived instantaneous water lines however, the difference in resolution seems well countered by processes deployed to spatially extract the waterline. The difference between the two lines presented in the right-hand plot in Figure \ref{landsat}, is \$\$\$\$ m and RMS difference of \$\$\$\$ m, well within the expected and observed precision of the method itself.  

\subsection{Limitations}
The SCoWI has been tested at various sites including very steep beaches, dissipative beaches, beaches with black volcanic sand, and it all seems to work reasonably well, however there are limitations to this method and perhaps in general to these spaceborne waterline detections. Since SCoWI is purely based on the radiometry, areas where little to no photons are reflected to the satellite sensor negatively impact the visibility and hence detection of the shoreline, think of shaded areas like cliffed beaches for example. Given the sun-synchronised nature of most Earth Observation optical satellites, these areas will have significantly fewer data availability. Morphological features around the waterline and/or shallow water features like atolls, inter-tidal flats remain a challenge. 

Slightly different but related to the radiometry, not the lack of reflectance, but the dependence of the SCoWI on the infra-red band information. Water and land are relatively easy to distinguish using the Near InfraRed (NIR) bands and even more so using Short Wave InfraRed (SWIR) bands. These bands are often missing in Very High Resolution (VHR) optical satellites. NIR at high resolution is attainable (Pleiades and Worldview), but it is significantly more complex to include SWIR bands at high resolution due to the boundaries of physics. Let alone smaller satellites that often have a different type of sensor onboard --matricial sensor instead of the line sensors combined with the push-broom concept. 

This new formulation has been visually verified at a dozen of sites around the world, but only one site was used to validate the absolute performance --at which it was not developed. While validation at the first stage of the development is not uncommon \citep{VOS2019_google,CASTELLE2021107707}, we are aware of recent efforts standardize validation at well-known sites. These sites are though slightly biased to higher latitudes and seasonally (storm) driven. Here we show that the extension to Landsat is possible using the ScoWI, further development is foreseen to extent the CNES' HPC pipeline with Landsat based SCoWI calculations. Once Landsat-SCoWI is in place the standardized shoreline verification sites will be used to analyse and compare the performance in greater detail. 

\section{Conclusion}
We present an optimised instantaneous waterline detection method (SCoWI) for coastal zones, fully based on the measured physical reflectance, and an effective separation between land and sea. The method is independent of auxiliary, external data, and demonstrates a stable behaviour for a great variety of coastal environments --and does not need training. Subpixel precision for the validation-site at Duck, NC at the US east-coast is found. However, difficulties are observed for shaded areas, there where photon reflectance is minimum, particularly at cliffed areas with the beach on the west-side (given the sun-synchronised nature of the Sentinel-2, but likewise Landsat). Our large scale application shows great efficiency in estimating the instantaneous waterline over 8 years in a few minutes when the data is available. Future work includes integration of Landsat satellite optical imagery analysis on the High Performance Cluster and deploying the power of 40-year long time-series at large spatial scales.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\vspace{6pt} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\authorcontributions{For research articles with several authors, a short paragraph specifying their individual contributions must be provided. The following statements should be used ``Conceptualization, X.X. and Y.Y.; methodology, X.X.; software, X.X.; validation, X.X., Y.Y. and Z.Z.; formal analysis, X.X.; investigation, X.X.; resources, X.X.; data curation, X.X.; writing---original draft preparation, X.X.; writing---review and editing, X.X.; visualization, X.X.; supervision, X.X.; project administration, X.X.; funding acquisition, Y.Y. All authors have read and agreed to the published version of the manuscript.'', please turn to the  \href{http://img.mdpi.org/data/contributor-role-instruction.pdf}{CRediT taxonomy} for the term explanation. Authorship must be limited to those who have contributed substantially to the work~reported.}

\funding{This work was fully funded by the French Space Agency (CNES)}

\acknowledgments{We would like to thank the US army corps of Engineers ERDC, at the FRF for all the effort in maintaining an incredible dataset of field measurements and making these data openly accessible.}

\conflictsofinterest{The authors declare no conflict of interest.} 

\abbreviations{Abbreviations}{
The following abbreviations are used in this manuscript:\\

\noindent 

\begin{tabular}{@{}ll}
AVISO & Archiving, Validation and Interpretation of Satellite Oceanographic Data\\
AWEI & Automated Water Extraction Index\\
CASSIE & Coastal Analyst System from Space Imagery Engine\\
CNES & Centre National d'Etudes Spatiales\\
ECFAS & European Coastal Flood Awareness System\\
ERDC & Engineer Research and Development Center\\
FES & Finite Element Solution\\
FRF & Field Research Facility\\
GPS & Global Positioning System\\
HPC & High Performance Cluster\\
IRD & Institut de Recherche pour le developpement\\
LEGOS & Laboratoire d’Etudes en Geophysique et Oceanographie Spatiales\\
NDWI & Normalised Difference Water Index\\
MNDWI & Mean Normalised Difference Water Index\\
MDPI & Multidisciplinary Digital Publishing Institute\\
NIR & Near Infrared\\
NOAA & National Oceanic and Atmospheric Administration\\
PEPS & Plateforme d'Exploitation des Produits Sentinel\\
RGB & Red-Green-Blue\\
RMS & Root Mean Square\\
SCoWI & Subtractive Coastal Water Index\\
SDS & Satellite Derived Shoreline\\
SWIR & Short Wave InfraRed
\end{tabular}
}

\reftitle{References}
%=====================================
% References, variant A: external bibliography
%=====================================
\bibliography{refbiblio}
\end{document}

